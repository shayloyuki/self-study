<!--
 * @Author: luoxue
 * @Date: 2022-05-06 19:12:06
 * @LastEditors: luoxue
 * @LastEditTime: 2022-05-06 21:10:21
 * @FilePath: \Projects\cash register.html
 * @Description: 
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    function checkCashRegister(price, cash, cid) {
      function changeArr(due) {

        let int = 0
        let float = 0

        if (due.toString().indexOf('.') === -1) {
          // 是整数
          int = due
        } else {
          // 有小数
          int = parseInt(due.toString().split('.')[0])
          float = parseFloat('0.' + due.toString().split('.')[1])
        }

        // 1. 整数部分
        const hundred = Math.floor(int / 100)
        const twenty = Math.floor((int - hundred * 100) / 20)
        const ten = Math.floor((int - hundred * 100 - twenty * 20) / 10)
        const five = Math.floor((int - hundred * 100 - twenty * 20 - ten * 10) / 5)
        const one = Math.floor((int - hundred * 100 - twenty * 20 - ten * 10 - five * 5) / 1)

        // 2. 小数部分精度问题：加减法可以用参数乘以1000再用结果除以1000
        const quarter = Math.floor((float / 0.25))
        const dime = Math.floor(((float * 1000 - quarter * 0.25 * 1000) / 1000) / 0.1)
        const nickel = Math.floor(((float * 1000 - quarter * 0.25 * 1000 - dime * 0.1 * 1000) / 1000) / 0.05)
        const penny = ((float * 1000 - quarter * 0.25 * 1000 - dime * 0.1 * 1000 - nickel * 0.05 * 1000) / 1000) / 0.01

        const unitObj = {
          'ONE HUNDRED': hundred,
          'TWENTY': twenty,
          'TEN': ten,
          'FIVE': five,
          'ONE': one,
          'QUARTER': quarter,
          'DIME': dime,
          'NICKEL':  nickel,
          'PENNY':  penny
        }
        for (unit in unitObj) {
          
        }
        const resArr = [
          ['ONE HUNDRED', hundred],
          ['TWENTY', twenty],
          ['TEN', ten],
          ['FIVE', five],
          ['ONE', one],
          ['QUARTER', quarter],
          ['DIME', dime],
          ['NICKEL', nickel],
          ['PENNY', penny]
        ]
        if (hundred > 0) {
          return ['ONE HUNDRED', hundred]
        }
        return resArr
      }

      // 应找零
      let due = cash - price;
      // console.log(due) // 0.5

      // 抽屉现金
      const drawTotal = cid[0][1] * 0.01 + cid[1][1] * 0.05 + cid[2][1] * 0.1 + cid[3][1] * 0.25 + cid[4][1] * 1 + cid[5][1] * 5 + cid[6][1] * 10 + cid[7][1] * 20 + cid[8][1] * 100
      // console.log(drawTotal) // 11766.4851

      // 状态码
      let key = ''
      // 找零数组
      let changeVal = []

      if (drawTotal < due) {
        // 收银机內的金额少于应找回的零钱数
        key = 'INSUFFICIENT_FUNDS'
        changeVal = []
      } else if (drawTotal === due) {
        // 收银机內的金额恰好等于应找回的零钱数
        key = 'CLOSED'
        changeVal = cid
      } else {
        key = 'OPEN'
        changeVal = changeArr(due)
      }

      const resObj = {
        status: key,
        change: changeVal
      }
      return resObj
    }

    console.log(checkCashRegister(19.5, 20, [["PENNY", 1.01], ["NICKEL", 2.05], ["DIME", 3.1], ["QUARTER", 4.25], ["ONE", 90], ["FIVE", 55], ["TEN", 20], ["TWENTY", 60], ["ONE HUNDRED", 100]]))  
  </script>
</body>
</html>
